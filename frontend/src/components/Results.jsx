import React from 'react'
import ResultCard from './ResultCard'

export default function Results({ items = [], loading, metadata }){
  if (loading) return <div className="results-placeholder">Looking for better promptsâ€¦</div>
  if (!items || items.length === 0) return null

  function exportAsJSON() {
    const exportData = {
      timestamp: new Date().toISOString(),
      metadata: metadata || {},
      enhanced_prompts: items,
      version: 'Prometheus Light v1.0'
    }
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `prometheus-prompts-${Date.now()}.json`
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
  }

  function exportAsText() {
    let textContent = '='.repeat(60) + '\n'
    textContent += 'PROMETHEUS - Enhanced Prompts\n'
    textContent += '='.repeat(60) + '\n\n'
    
    if (metadata) {
      textContent += `Generated: ${new Date().toLocaleString()}\n`
      textContent += `Target Model: ${metadata.targetModel || 'N/A'}\n`
      textContent += `Original Prompt: ${metadata.originalPrompt || 'N/A'}\n`
      if (metadata.ragUsed) {
        textContent += `RAG Guidelines: ${metadata.ragChunks || 0} retrieved\n`
      }
      textContent += '\n' + '-'.repeat(60) + '\n\n'
    }
    
    items.forEach((prompt, idx) => {
      textContent += `VARIANT ${idx + 1}:\n`
      textContent += '-'.repeat(60) + '\n'
      textContent += prompt + '\n\n'
    })
    
    textContent += '='.repeat(60) + '\n'
    textContent += 'Generated by Prometheus Light v1.0\n'
    
    const blob = new Blob([textContent], { type: 'text/plain' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `prometheus-prompts-${Date.now()}.txt`
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
  }

  function copyAllPrompts() {
    const allText = items.join('\n\n' + '='.repeat(60) + '\n\n')
    navigator.clipboard.writeText(allText)
      .then(() => {
        // You could add a toast notification here
        console.log('All prompts copied to clipboard')
      })
      .catch(err => console.error('Failed to copy:', err))
  }

  return (
    <div className="results-container">
      <div className="results-actions">
        <button className="action-button" onClick={copyAllPrompts} title="Copy all prompts">
          ðŸ“‹ Copy All
        </button>
        <button className="action-button" onClick={exportAsText} title="Export as text file">
          ðŸ“„ Export TXT
        </button>
        <button className="action-button" onClick={exportAsJSON} title="Export as JSON">
          ðŸ’¾ Export JSON
        </button>
      </div>
      
      <div className="results-list">
        {items.map((it, idx)=>(<ResultCard key={idx} text={it} index={idx+1} />))}
      </div>
    </div>
  )
}
